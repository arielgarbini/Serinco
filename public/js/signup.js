window.RU=window.RU||{},window.RU.Registration=window.RU.Registration||{},RU.Registration.PasswordTooBig="Sorry, this is too long. Please keep it under 30 characters.",RU.Registration.PasswordTooSmall="Password is too short – it must be at least 6 characters.",RU.Registration.PasswordHasWrongFormat="TODO://add password format message",RU.Registration.EmailIsInUse="This email is registered to another account.",RU.Registration.ArtistTooBig="Sorry, this is too long. Please keep it under 32 characters.",RU.Registration.ArtistTooSmall="Artist name is too short – it must be at least 2 characters.",RU.Registration.AgreementMessage=" This is easy, just tick the box.",RU.Registration.Base=Class([RU.Common.EmailPage],function(){var a=function(){c.call(this),b.call(this)},b=function(){$(".message").click(function(){return $(this).fadeOut(),!1})},c=function(){this.agreeCheck.on("change",function(){var a=this.agreeCheck.parent().find("label"),b=this.agreeCheck.is(":checked");b?(a.removeClass("unchecked"),a.addClass("checked"),this.hideValidationMessage(this.agreeCheck)):(a.removeClass("checked"),a.addClass("unchecked"))}.bind(this)),this.agreeCheck.change()},d=function(){return!!this.agreeCheck.is(":checked")||(this.onAgreeUnchecked(),!1)},e=function(a,b){var c=this,d=sprintf(this.validateEmailUrl,Settings.url.app,a);$.get(d,function(d){d===a?c.onEmailIsInUse():b&&b.call(c)})},f=function(){var a=this.artistField.val();return a&&0!=a.length?this.artistMin>a.length?(this.onArtistToSmall(),!1):!(this.artistMax<a.length)||(this.onArtistToBig(),!1):(this.onFieldIsEmpty(this.artistField),!1)},g=function(){var a=this.passField.val();return a&&0!=a.length?this.passwordMin>a.length?(this.onPasswordToSmall(),!1):this.passwordMax<a.length?(this.onPasswordToBig(),!1):!(this.passwordReg&&!this.passwordReg.test(a))||(this.onPasswordWrongFormat(),!1):(this.onFieldIsEmpty(this.passField),!1)};return{validateEmailUrl:"%s/api/email/%s",passField:null,artistField:null,anrCodeSwitch:null,anrCodeContainer:null,anrCode:null,agreeCheck:null,passwordMax:30,passwordMin:6,passwordReg:null,artistMax:32,artistMin:2,emailLetterSetReg:/^([a-zA-Z0-9_\.\-\+\@])+$/,emailFormatReg:/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,emailMaxLength:255,constructor:function(){this.emailField=$("input#signupEmail"),this.passField=$("input#signupPassword"),this.artistField=$("input#signupArtistName"),this.agreeCheck=$("input#signupAgreement"),a.call(this),RU.Registration.Base.$super.call(this)},doRequest:function(a){var b=this;e.call(this,a.email,function(){RU.Registration.Base.$superp.doRequest.call(b,a)})},buildRequest:function(a){var b=RU.Registration.Base.$superp.buildRequest.call(this,a);return b.method="POST",b.data=a,b.headers={"g-Recaptcha-Response":this.getCaptchaResponse(),mixpanelId:"mixpanel"},b},getFormValues:function(){var a=RU.Registration.Base.$superp.getFormValues.call(this);return a.password=this.passField.val(),a.name=this.artistField.val(),a},isFormValid:function(){var a=RU.Registration.Base.$superp.isFormValid.call(this);return this.isPasswordValid()||(a=!1),this.isAgreeChecked()||(a=!1),this.isArtistValid()||(a=!1),this.isCaptchaValid()||(a=!1),a},isPasswordValid:function(){return g.call(this)},isAgreeChecked:function(){return d.call(this)},isArtistValid:function(){return f.call(this)},onEmailIsInUse:function(){this.showValidationMessage(this.emailField,RU.Registration.EmailIsInUse),this.bindSubmit(),this.hideLoader(),this.resetRecapcha()},onPasswordToSmall:function(){this.showValidationMessage(this.passField,RU.Registration.PasswordTooSmall)},onPasswordToBig:function(){this.showValidationMessage(this.passField,RU.Registration.PasswordTooBig)},onPasswordWrongFormat:function(){this.showValidationMessage(this.passField,RU.Registration.PasswordHasWrongFormat)},onAgreeUnchecked:function(){this.showValidationMessage(this.agreeCheck,RU.Registration.AgreementMessage)},onArtistToSmall:function(){this.showValidationMessage(this.artistField,RU.Registration.ArtistTooSmall)},onArtistToBig:function(){this.showValidationMessage(this.artistField,RU.Registration.ArtistTooBig)}}}),window.RU=window.RU||{},window.RU.Registration=window.RU.Registration||{},RU.Registration.RU=Class([RU.Registration.Base],function(){var a=function(){var a=this;$.ajax({crossDomain:!0,dataType:"json",method:"get",url:this.countriesUrl,success:function(b){var c="";$.each(b,function(a,b){c+=sprintf("<option value='%i'>%s</option>",b.id||b.Id,b.name||b.Name)}),a.countryField.append(c),a.countryField.on("change",a.hideValidationMessage.bind(a,a.countryField)),a.countryField.chosen()}})},b=function(){var a=this.countryField.val();return!(!a||0==a.length)||(this.onFieldIsEmpty(this.countryField),!1)};return{url:"/api/account/create",countriesUrl:"/api/countries",countryField:null,getSubmitUrl:function(){return Settings.url.app+this.url},constructor:function(){this.countriesUrl=Settings.url.app+this.countriesUrl,this.countryField=$("select[name='country']"),this.submitBtn=$("#signupBtn"),this.submitBlock=$("#submit"),this.successBlock=$("#success"),this.loader=$("#loader"),this.captchaSelector="#recaptcha",a.call(this),RU.Registration.RU.$super.call(this)},getFormValues:function(){var a=RU.Registration.RU.$superp.getFormValues.call(this);return $.extend({country:this.countryField.val()},a)},isFormValid:function(){var a=RU.Registration.RU.$superp.isFormValid.call(this);return this.isCountryValid()||(a=!1),a},isCountryValid:function(){return b.call(this)},processSuccess:function(){var a=this.emailField.val(),b=$("#activateLink"),c=b.attr("href"),d=sprintf("%s?email=%s&type=activate",c,a);b.attr("href",d),$("#email-address").text(a),RU.Registration.RU.$superp.processSuccess.call(this)},processErrors:function(a){RU.Registration.RU.$superp.processErrors.call(this,a),a.errors&&a.errors.length>0&&this.showValidationMessage(this.emailField,a.errors[0])}}}),$(function(){RU.Page=new RU.Registration.RU});